CLIENT_ID="963009065087-2a5ccl5rhm4ghgm88li21fkjgsu5eua0@developer.gserviceaccount.com",SCOPES="https://www.googleapis.com/auth/userinfo.email",RESPONSE_TYPE="token id_token",init=function(){var o,a="//"+window.location.host+"/_ah/api";-1===window.location.host.indexOf("localhost")&&(a="https://roseboticsweb.appspot.com/_ah/api");var t=function(){0==--o&&angular.bootstrap(document,["TeamApp"])};o=2,gapi.client.load("teams","v1",t,a),gapi.client.load("oauth2","v2",t)};
;"use strict";angular.module("TeamApp",["TeamControllers","ModalControllers","OverviewControllers","ManageControllers","TeamServices","InviteControllers","ui.bootstrap","ngRoute","TeamDirectives","angular.snackbar"]).config(["$routeProvider",function(e){e.when("/overview/",{templateUrl:"/static/teams/partials/overview.html",controller:"OverviewCtrl as overview"}).when("/preview/",{templateUrl:"/static/teams/partials/preview.html",controller:"PreviewCtrl as preview"}).when("/teams/",{templateUrl:"/static/teams/partials/teams.html",controller:"TeamsCtrl as teams",resolve:{teams:["api",function(e){return e.getTeams()}]}}).when("/teams/:team_key/courses",{templateUrl:"/static/teams/partials/teams_course.html",controller:"TeamsCourseCtrl as courses",resolve:{team:["api","$route",function(e,t){return e.getProgress(t.current.params)}]}}).when("/teams/:team_key/courses/:course_name/tracks",{templateUrl:"/static/teams/partials/teams_track.html",controller:"TeamsTrackCtrl as tracks",resolve:{team:["api","$route",function(e,t){return e.getProgress(t.current.params)}]}}).when("/teams/:team_key/courses/:course_name/tracks/:track_name/units",{templateUrl:"/static/teams/partials/teams_unit.html",controller:"TeamsUnitCtrl as units",resolve:{team:["api","$route",function(e,t){return e.getProgress(t.current.params)}]}}).when("/invites/",{templateUrl:"/static/teams/partials/invites.html",controller:"InvitesCtrl as invites",resolve:{invites:["api",function(e){return e.getInvites()}]}}).when("/manage/",{templateUrl:"/static/teams/partials/manage.html",controller:"ManageCtrl as manage",resolve:{teams:["api",function(e){return e.getLeadTeams()}]}}).when("/manage/:team_key",{templateUrl:"/static/teams/partials/manage_team.html",controller:"ManageTeamCtrl as manage",resolve:{teams:["api",function(e){return e.getLeadTeams()}],user:["oAuth",function(e){return e.getUserInfo()}]}}).otherwise({redirectTo:"/overview/"})}]).run(["$rootScope","$location","oAuth","sidebar",function(e,t,r,a){angular.element(document.querySelectorAll(".hidden.container")).removeClass("hidden"),angular.element(document.querySelector("div.spinner")).addClass("hidden"),r.check().then(null,function(){t.path("/preview"),a.show.set(!1)})}]);
;angular.module("InviteControllers",[]).controller("InvitesCtrl",["invites","api","snackbar",function(e,s,n){this.pending=[],this.accepted=[];var t=e.invites;void 0==t&&(t=[]);for(var i=0;i<t.length;i++)"NOT_CHOSEN"===t[i].response?this.pending.push(t[i]):this.accepted.push(t[i]);var r=this;this.editInvite=function(e,t){var i=!1;if("NOT_CHOSEN"===e.response&&"NOT_CHOSEN"!==t){for(var o=0;o<r.pending.length;o++)if(r.pending[o].team_key===e.team_key){r.pending.splice(o,1);break}r.accepted.push(e),i=!0}if("REJECT_INVITE"===t){for(var o=0;o<r.accepted.length;o++)if(r.accepted[o].team_key===e.team_key){r.accepted.splice(o,1);break}i=!0}e.response=t,n.create("Sending response...",4),s.editInvite(e).then(function(){n.remove(4),n.createWithTimeout("<b>Success!</b> Response saved"),i&&s.getTeams(!0)},function(){n.remove(4),n.createWithTimeout("<b>Error!</b> Response not saved")})},this.pendingResponses=["NOT_CHOSEN","ALL_MEMBERS","TEAM_LEADER","REJECT_INVITE"],this.acceptedResponses=["ALL_MEMBERS","TEAM_LEADER","REJECT_INVITE"],this.responseOptions={NOT_CHOSEN:"No response",ALL_MEMBERS:"All members can see my progress",TEAM_LEADER:"Only the leader can see my progress",REJECT_INVITE:"Reject invite and no one can see my progress"}}]);
;angular.module("ManageControllers",[]).controller("ManageCtrl",["$modal","teams","api","snackbar","oAuth",function(e,t,a,r,o){this.items=t.teams;var m=this;this.toggleCreateTeamModal=function(){var n=e.open({templateUrl:"/static/teams/partials/modals/create_team_modal.html",controller:"CreateTeamModalInstanceCtrl",controllerAs:"modal",resolve:{user:function(){return o.getUserInfo()}}});n.result.then(function(e){r.create("Creating team...",1),a.insertTeam(e).then(function(e){r.remove(1),r.createWithTimeout("<b>Success!</b> Team created"),void 0==t.teams&&(t.teams=[],m.items=t.teams),t.teams.push(e)},function(){r.remove(1),r.createWithTimeout("<b>Error!</b> Team not created")})})}}]).controller("ManageTeamCtrl",["$routeParams","$modal","teams","$scope","snackbar","api","$location","user",function(e,t,a,r,o,m,n,i){for(var s=a.teams,l=-1,c=0;c<s.length;c++)if(s[c].team_key==e.team_key){this.team=s[c],l=c;break}var u=0,h=this,b=r.$watch(function(){return h.team},function(){u++,h.onInputMadeDirty(u)},!0);this.onInputMadeDirty=function(e){e>1&&(o.createWithTimeout("<b>Warning!</b> You must press submit to save your changes"),b())},this.deleteMember=function(e){for(var t=h.team.members,a=0;a<t.length;a++)if(t[a].email==e.email){t.splice(a,1);break}},this.saveTeam=function(){o.create("Saving team...",3),m.insertTeam(h.team).then(function(){o.remove(3),o.createWithTimeout("<b>Success!</b> Team saved")},function(){o.remove(3),o.createWithTimeout("<b>Error!</b> Team not saved")})},this.toggleDeleteTeamModal=function(){var e=t.open({templateUrl:"/static/teams/partials/modals/delete_team_modal.html",controller:"DeleteTeamModalInstanceCtrl",controllerAs:"modal"});e.result.then(function(){s.splice(c,1),o.create("Deleting team...",2),m.deleteTeam(h.team).then(function(){o.remove(2),o.createWithTimeout("<b>Success!</b> Team deleted")},function(){o.remove(2),o.createWithTimeout("<b>Error!</b> Team not deleted")}),n.path("/manage")})},this.toggleCreateMemberModal=function(){var e=t.open({templateUrl:"/static/teams/partials/modals/create_member_modal.html",controller:"NewMemberModalInstanceCtrl",controllerAs:"modal"});e.result.then(function(e){var t={email:e,visibility:"NOT_CHOSEN"};void 0==h.team.members&&(h.team.members=[]),e==i.email&&(t.visibility="ALL_MEMBERS"),h.team.members.push(t),h.team.newMembers=!0})},this.visibilityOptions={NOT_CHOSEN:"No Response",ALL_MEMBERS:"Progress visible by everyone",TEAM_LEADER:"Progress visible to leader only"}}]);
;angular.module("ModalControllers",[]).controller("ModalToggleCtrl",["$modal",function(e){this.toggleSignOutModal=function(){e.open({templateUrl:"logout_modal.html",controller:"SimpleModalInstanceCtrl",controllerAs:"modal"})},this.toggleEditProfileModal=function(){e.open({templateUrl:"edit_profile_modal.html",controller:"SimpleModalInstanceCtrl",controllerAs:"modal"})}}]).controller("SimpleModalInstanceCtrl",["$modalInstance",function(e){this.cancel=function(){e.dismiss("cancel")}}]).controller("NewMemberModalInstanceCtrl",["$modalInstance","$controller",function(e,t){angular.extend(this,t("SimpleModalInstanceCtrl",{$modalInstance:e})),this.email="",this.addMember=function(t){return t=t.trim(),0===t.length?void e.dismiss("cancel"):(t.indexOf("@")<0&&(t+="@gmail.com"),void e.close(t))}}]).controller("DeleteTeamModalInstanceCtrl",["$modalInstance","$controller",function(e,t){angular.extend(this,t("SimpleModalInstanceCtrl",{$modalInstance:e})),this.remove=function(){e.close()}}]).controller("CreateTeamModalInstanceCtrl",["$modalInstance","$controller","user",function(e,t,a){angular.extend(this,t("SimpleModalInstanceCtrl",{$modalInstance:e})),this.teamName="",this.teamMembers="",this.includeLeader=!1;var n=this;this.add=function(){for(var t={name:n.teamName,leader:a.email,members:[]},l=n.teamMembers.split(","),o=0;o<l.length;o++){var r=l[o].trim();0!==r.length&&(r.indexOf("@")<0&&(r+="@gmail.com"),t.members.push({email:r,visibility:"NOT_CHOSEN"}))}n.includeLeader&&t.members.push({email:a.email,visibility:"ALL_MEMBERS"}),e.close(t)}}]).controller("ExportModalInstanceCtrl",["$modalInstance","$controller","team","$window",function(e,t,a,n){if(angular.extend(this,t("SimpleModalInstanceCtrl",{$modalInstance:e})),this.team=a,this.fullname=!0,this.username=!0,this.hasTimestamp=!0,this.timezone="Eastern",this.timezones=["UTC","Eastern","Central","Mountain","Pacific"],this.data=[],a.members_progress.length>0){this.courses=a.members_progress[0].course_progress;for(var l=0;l<courses.length;l++){for(var o={name:courses[l].name,tracks:[]},r=courses[l].track_progress,s=0;s<r.length;s++){for(var i={name:r[s].name,units:[]},m=r[s].unit_progress,c=0;c<m.length;c++)i.units.push({name:m[c].name,toggled:!1});o.tracks.push(i)}this.data.push(o)}}var d=this;this.generate=function(){console.log(d.data,d.fullname,d.username);var t="http://"+n.location.host+"/teams/export.csv";t+="?team_urlsafe="+a.team_key,d.fullname&&(t+="&student_name=true"),d.username&&(t+="&rose_username=true"),d.hasTimestamp&&(t+="&timezone="+d.timezone),progress_data=angular.copy(d.data);for(var l=0;l<progress_data.length;l++)for(var o=progress_data[l],r=0;r<o.tracks.length;r++){for(var s=o.tracks[r],i=[],m=0;m<s.units.length;m++){var c=s.units[m];c.toggled&&i.push(c.name)}s.units=i}t+="&progress_data="+encodeURIComponent(JSON.stringify(progress_data)),console.log(t),n.open(t,"_blank"),e.close()}}]);
;angular.module("OverviewControllers",[]).controller("OverviewCtrl",function(){}).controller("PreviewCtrl",["oAuth","$location","sidebar","$rootScope","snackbar","userEmail",function(t,e,o,n,r,i){t.check().then(function(){e.path("/overview"),o.show.set(!0),n.$apply()}),this.signup=function(){t.signup().then(function(){t.getUserInfo().then(function(t){t.email!==i&&r.createWithTimeout("<b>Danger!</b> Signing up for teams with another account may cause errors!",6e3)}),e.path("/overview"),o.show.set(!0)},function(){r.createWithTimeout("<b>Error!</b> Sign up failed")})}}]).controller("SidebarCtrl",["sidebar","$location","$scope",function(t,e,o){this.routes=t.routes,this.show=t.show.get();var n=this;o.$watch(function(){return t.show.get()},function(t){n.show=t}),this.isActive=function(t){var o=e.path();return t=t.substring(1),o.startsWith(t)}}]);
;angular.module("TeamControllers",[]).controller("TeamsCtrl",["$modal","teams",function(r,e){this.items=e.teams}]).controller("TeamsParentCtrl",["$modal","team",function(r,e){this.toggleExportProgressModal=function(){r.open({templateUrl:"/static/teams/partials/modals/export_progress_modal.html",controller:"ExportModalInstanceCtrl",controllerAs:"modal",resolve:{team:function(){return e}}})}}]).controller("TeamsCourseCtrl",["$modal","team","$controller",function(r,e,s){if(angular.extend(this,s("TeamsParentCtrl",{$modal:r,team:e})),this.team=e,void 0==e.members_progress&&(this.team.members_progress=[]),this.courses=[],e.members_progress.length>0){courses=e.members_progress[0].course_progress;for(var t=0;t<courses.length;t++)this.courses.push(courses[t].name)}}]).controller("TeamsTrackCtrl",["$routeParams","team","$modal","$controller",function(r,e,s,t){if(angular.extend(this,t("TeamsParentCtrl",{$modal:s,team:e})),this.team=e,void 0==e.members_progress&&(this.team.members_progress=[]),this.course=r.course_name,this.tracks=[],e.members_progress.length>0)for(var o=e.members_progress[0].course_progress,a=0;a<o.length;a++)if(o[a].name===this.course){this.courseNum=a;for(var m=o[a].track_progress,n=0;n<m.length;n++)this.tracks.push(m[n].name);break}var l=this;this.getProgressForMemberTrack=function(r,e){return r.course_progress[l.courseNum].track_progress[e].progress}}]).controller("TeamsUnitCtrl",["$routeParams","team","$modal","$controller",function(r,e,s,t){if(angular.extend(this,t("TeamsParentCtrl",{$modal:s,team:e})),this.team=e,void 0==e.members_progress&&(this.team.members_progress=[]),this.course=r.course_name,this.track=r.track_name,this.units=[],e.members_progress.length>0)for(var o=e.members_progress[0].course_progress,a=0;a<o.length;a++)if(o[a].name===this.course){this.courseNum=a;for(var m=o[a].track_progress,n=0;n<m.length;n++)if(m[n].name===this.track){this.trackNum=n;for(var l=m[n].unit_progress,i=0;i<l.length;i++)this.units.push(l[i].name);break}break}var c=this;this.getProgressForMemberUnit=function(r,e){return r.course_progress[c.courseNum].track_progress[c.trackNum].unit_progress[e].progress}}]);
;angular.module("TeamServices",[]).factory("sidebar",function(){var e=!0;return{routes:[{name:"Overview",href:"#/overview/"},{name:"Teams",href:"#/teams/"},{name:"Invites",href:"#/invites/"},{name:"Manage",href:"#/manage/"}],show:{get:function(){return e},set:function(t){e=t}}}}).factory("userEmail",["$rootScope",function(e){return e.userEmail}]).service("oAuth",["$q","$location",function(e){var t=function(t){return function(){var i=e.defer();return gapi.auth.authorize({client_id:CLIENT_ID,scope:SCOPES,immediate:t},function(e){e.error?i.reject(e):i.resolve(e)}),i.promise}};this.signup=t(!1),this.check=t(!0),this.execute=function(t){var i=e.defer();return gapi.auth.authorize({client_id:CLIENT_ID,scope:SCOPES,immediate:!0},function(){t.execute(function(e){e.code?i.reject(e):i.resolve(e.result)})}),i.promise},this.getUserInfo=function(){return this.execute(gapi.client.oauth2.userinfo.get())}}]).service("api",["oAuth","$q",function(e,t){var i={},n=function(n,r){return function(a){var s=t.defer();return void 0!=i[n]&&void 0==a?(s.resolve(i[n]),s.promise):(e.execute(r).then(function(e){i[n]=e,s.resolve(e)},function(e){s.reject(e)}),s.promise)}};this.deleteTeam=function(t){if(void 0!=i.get_teams)for(var n=i.get_teams.teams,r=0;r<n.length;r++)if(t.team_key==n[r].team_key){n.splice(r,1);break}return e.execute(gapi.client.teams.delete(t))},this.insertTeam=function(n){var r=t.defer(),a=void 0!=i.get_teams,s=void 0,o=void 0==n.team_key;return a&&(s=i.get_teams.teams,void 0==s&&(i.get_teams.teams=[],s=i.get_teams.teams)),e.execute(gapi.client.teams.insert(n)).then(function(e){if(a)if(o)s.push(e);else for(var t=0;t<s.length;t++)if(e.team_key===s[t].team_key){s[t]=e;break}r.resolve(e)},function(e){r.reject(e)}),r.promise},this.getInvites=n("get_invites",gapi.client.teams.invites.list()),this.editInvite=function(t){return e.execute(gapi.client.teams.invites.respond(t))},this.getTeams=n("get_teams",gapi.client.teams.list.all()),this.getLeadTeams=n("get_lead_teams",gapi.client.teams.list.leader()),this.getProgress=function(n){var r=t.defer();return void 0!=i[n.team_key]?(r.resolve(i[n.team_key]),r.promise):(e.execute(gapi.client.teams.progress(n)).then(function(e){i[n.team_key]=e,r.resolve(e)},function(e){r.reject(e)}),r.promise)}}]);
;angular.module("TeamDirectives",[]).directive("teamTitle",function(){return{restrict:"E",scope:{team:"="},templateUrl:"/static/teams/partials/components/team_title.html"}}).directive("routeLoadingIndicator",["$rootScope",function(t){return{restrict:"E",templateUrl:"/static/teams/partials/components/loading_spinner.html",link:function(){t.$on("$routeChangeStart",function(){t.isRouteLoading=!0}),t.$on("$routeChangeSuccess",function(){t.isRouteLoading=!1})}}}]).filter("percentage",["$filter",function(t){return function(e,n){return t("number")(100*e,n)+"%"}}]);
;/*
	@license Angular Snackbar version 1.0.1
	ⓒ 2015 Tyler Rockwood https://github.com/rockwotj/angular.snackbar
	License: MIT
*/

!function(a){"use strict";var n=a.module("angular.snackbar",[]);n.factory("snackbar",["$rootScope",function(a){return{createWithTimeout:function(n,e){a.$broadcast("createSnackbarWithTimeout",{content:n,duration:e})},create:function(n,e){a.$broadcast("createSnackbar",{content:n,id:e})},remove:function(n){a.$broadcast("removeSnackbar",{id:n})}}}]),n.directive("snackbar",["$rootScope","$compile","$timeout",function(n,e,c){return function(t,r,o){var s=a.element(r),i=o.snackbarDuration||3e3,u=o.snackbarRemoveDelay||20;n.$on("createSnackbarWithTimeout",function(n,r){var o='<div class="snackbar snackbar-opened"><span class="snackbar-content">'+r.content+"</span></div>",b=a.element(e(o)(t));s.append(b),c(function(){b.removeClass("snackbar-opened"),c(function(){b.remove()},u,!1)},r.duration||i,!1)}),n.$on("createSnackbar",function(n,c){var r='<div class="snackbar snackbar-opened snackbar-id-'+c.id+'"><span class="snackbar-content">'+c.content+"</span></div>",o=a.element(e(r)(t));s.append(o)}),n.$on("removeSnackbar",function(n,e){var c=a.element(s[0].getElementsByClassName("snackbar-id-"+e.id));c.removeClass("snackbar-opened"),c.remove()})}}])}(angular);

